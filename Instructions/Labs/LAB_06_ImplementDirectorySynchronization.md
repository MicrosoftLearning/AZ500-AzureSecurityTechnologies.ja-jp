---
lab:
  title: 06 - ディレクトリ同期を導入する
  module: Module 01 - Manage Identity and Access
---

# ラボ 06:ディレクトリ同期を導入する
# 受講生用ラボ マニュアル

## ラボのシナリオ

オンプレミスの Microsoft Entra Domain Services 環境を Microsoft Entra テナントに統合する方法を示す概念実証を作成するように求められています。 具体的には、次のことを行います。

- Microsoft Entra Domain Services のドメイン コントローラーをホストする Azure VM をデプロイして単一ドメインの Microsoft Entra Domain Services フォレストを導入する
- Microsoft Entra テナントを作成して構成する
- Microsoft Entra Domain Services フォレストを Microsoft Entra テナントと同期する

> このラボのすべてのリソースについて、**米国東部**リージョンを使用しています。 これがクラスで使用するリージョンであることを講師に確認します。 

## ラボの目的

このラボでは、次の演習を行います。

- 演習 1: Microsoft Entra ID ドメイン コントローラーをホストする Azure VM をデプロイする
- 演習 2: Microsoft Entra テナントを作成して構成する
- 演習 3: Microsoft Entra ID フォレストを Microsoft Entra テナントと同期する

## ディレクトリ同期を導入する

![image](https://github.com/MicrosoftLearning/AZ500-AzureSecurityTechnologies/assets/91347931/5d9cc4c7-7dcd-4d88-920d-9c97d5a482a2)

## 手順

### 演習 1: Microsoft Entra ID ドメイン コントローラーをホストする Azure VM をデプロイする

### 推定時間:10 分

この演習では、次のタスクを実行します。

- タスク 1:Azure VM のデプロイで利用可能な DNS 名を特定する
- タスク 2: ARM テンプレートを使用して、Microsoft Entra ID ドメイン コントローラーをホストする Azure VM をデプロイする

#### タスク 1:Azure VM のデプロイで利用可能な DNS 名を特定する

このタスクでは、Azure VM デプロイの DNS 名を識別します。 

1. Azure portal **`https://portal.azure.com/`** にサインインします。

    >**注**:このラボで使用している Azure サブスクリプションで所有者ロールまたは共同作成者ロールを持つアカウントを使用して Azure portal にサインインします。

2. Azure portal の右上にある最初のアイコンをクリックして、Cloud Shell を開きます。 メッセージが表示されたら、**[PowerShell]** と **[ストレージの作成]** をクリックします。

3. [Cloud Shell] ペインの左上隅にあるドロップダウン メニューで **[PowerShell]** が選択されていることを確認します。

4. Cloud Shell ペイン内の PowerShell セッションで、次の手順を実行して、この演習の次のタスクで Azure VM のデプロイに使用できる利用可能な DNS 名を特定します:

    ```powershell
    Test-AzDnsAvailability -DomainNameLabel <custom-label> -Location '<location>'
    ```

    >**注**:`<custom-label>` プレースホルダーを、グローバルに一意である可能性が高い有効な DNS 名に置き換えます。 `<location>` プレースホルダーを、このラボで使用する Active Directory ドメイン コントローラーをホストする Azure VM をデプロイするリージョンの名前に置き換えます。

    >**注**:Azure VM をプロビジョニングできる Azure リージョンを特定するには、[ **https://azure.microsoft.com/en-us/regions/offers/** ](https://azure.microsoft.com/en-us/regions/offers/) を参照してください

5. コマンドが **True** を返したことを確認します。 そうでない場合は、コマンドが **True** を戻すまで、異なる値の `<custom-label>` で同じコマンドを再実行します。

6. 成功した結果をもたらした `<custom-label>` の値を記録します。 これは、次のタスクで必要になります。

7. Cloud Shell を閉じます。

#### タスク 2: ARM テンプレートを使用して、Microsoft Entra ID ドメイン コントローラーをホストする Azure VM をデプロイする

このタスクでは、Microsoft Entra ID ドメイン コントローラーをホストする Azure VM をデプロイします。

1. 同じブラウザー ウィンドウで別のブラウザー タブを開き、 **https://github.com/Azure/azure-quickstart-templates/tree/master/application-workloads/active-directory/active-directory-new-domain** に移動します。

2. **[新しい AD フォレストで Azure VM を作成する]** ページで、 **[Azure にデプロイ]** をクリックします。 これにより、ブラウザーが Azure portal の **[新しい AD フォレストで Azure VM を作成する]** ブレードに自動的にリダイレクトされます。 

3. **[新しい AD フォレストで Azure VM を作成する]** ブレードで、**[パラメーターの編集]** をクリックします。

4. **[パラメーターの編集]** ブレードで、 **[ファイルの読み込み]** をクリックし、 **[開く]** ダイアログ ボックスで、フォルダー **\\\\AllFiles\Labs\\06\\active-directory-new-domain\\azuredeploy.parameters.json** に移動し、 **[開く]** をクリックして、 **[保存]** をクリックします。

5. **[新しい AD フォレストで Azure VM を作成する]** ブレードで、次の設定を指定します (他の設定は既存の値のままにします)。

   |設定|値|
   |---|---|
   |サブスクリプション|Azure サブスクリプションの名前|
   |Resource group|**[新規作成]** をクリックし、「**AZ500LAB06**」という名前を入力します|
   |リージョン|前のタスクで特定した Azure リージョン|
   |管理ユーザー名|**Student**|
   |管理パスワード|**ラボ 04 > 演習 1 > タスク 1 > 手順 9 で作成した個人用パスワードを使用してください。**|
   |ドメイン名|**adatum.com**|
   |DNS プレフィックス|前のタスクで識別した DNS ホスト名|
   |VM サイズ|**Standard_D2s_v3**|

6. **[新しい AD フォレストで Azure VM を作成する]** ブレードで、**[確認および作成]** をクリックし、**[作成]** をクリックします。

    >**注**:デプロイが完了するのを待たず、代わりに次の演習に進みます。 デプロイには約 15 分間かかります。 このラボの 3 番目の演習では、このタスクでデプロイされた仮想マシンを使用します。

> 結果: この演習を完了すると、Azure Resource Manager テンプレートを使用して、Microsoft Entra ID ドメインコントローラーをホストする Azure VM のデプロイを開始します。


### 演習 2: Microsoft Entra テナントを作成して構成する 

### 推定時間:20 分

この演習では、次のタスクを実行します。

- タスク 1: Microsoft Entra テナントを作成する
- タスク 2: 新しい Microsoft Entra テナントにカスタム DNS 名を追加する
- タスク 3: グローバル管理者ロールを持つ Microsoft Entra ID ユーザーを作成する

#### タスク 1: Microsoft Entra テナントを作成する

このタスクでは、このラボで使用する新しい Azure AD テナントを作成します。 

1. Azure portal で、Azure portal ページの上部にある **[リソース、サービス、ドキュメントの検索]** テキスト ボックスに「**Microsoft Entra ID**」と入力し、**Enter** キーを押します。

2. 現在の Azure AD テナントの **[概要]** を表示しているブレードで、 **[テナントの管理]** をクリックし、次の画面で **[+ 作成]** をクリックします。

3. **[テナントの作成]** ウィンドウの **[基本]** タブで、**[Microsoft Entra ID]** オプションが選択されていることを確認し、**[次へ: 構成 >] ** を選択します。

4. **[ディレクトリの作成]** ブレードの **[構成]** タブで、次の設定を指定します。

   |設定|値|
   |---|---|
   |組織名|**AdatumSync**|
   |初期ドメイン名|文字と数字の組み合わせから成る一意の名前|
   |国/リージョン|**米国**|

    >**注**:初期ドメイン名を記録します。 このラボで後ほど必要になります。

    >**注**:**[初期ドメイン名]** テキスト ボックスの緑色のチェック マークは、入力したドメイン名が有効で一意であるかどうかを示します。 (後で使用するために、初期ドメイン名を記録してください)。

5. **[Review + create](レビュー + 作成)** をクリックし、 **[作成]** をクリックします。

    >**注**:新しいテナントが作成されるのを待ちます。 **通知** アイコンを使用して、デプロイ ステータスを監視します。 

#### タスク 2:新しい Azure AD テナントにカスタム DNS 名を追加する

このタスクでは、新しい Azure AD テナントにカスタム DNS 名を追加します。 

1. Azure portal のツール バーで、Cloud Shell アイコンの右側にある **[ディレクトリ + サブスクリプション]** アイコンをクリックします。 

2. **[Directory + subscription]** ブレードで、新しく作成したテナント **AdatumSync** の行を選択し、**切り替え**ボタンをクリックします。

    >**注**:**AdatumSync** エントリが **Directory + subscription** のフィルター リストに表示されない場合は、ブラウザーの画面を更新する必要があります。

3. **[AdatumSync \| Microsoft Entra ID]** ブレードの **[管理]** セクションで、**[カスタム ドメイン名]** をクリックします。

4. **[AdatumSync \| カスタム ドメイン名]** ブレードで、 **[+ カスタム ドメインの追加]** をクリックします。

5. **[カスタム ドメイン名]** ブレードの **[カスタム ドメイン名]** テキスト ボックスに「**adatum.com**」と入力し、**[ドメインの追加]** をクリックします。

6. **adatum.com** ブレードで、Microsoft Entra ドメイン名の検証を実行するために必要な情報を確認し、**[削除]** を 2 回選択します。 

    >**注**:**adatum.com** DNS ドメイン名を所有していないため、検証プロセスを完了できません。 これにより、**adatum.com** Microsoft Entra Domain Services ドメインを Microsoft Entra テナントと同期できなくなります。 この目的のために、前のタスクで特定した Microsoft Entra テナントの最初の DNS 名 (**onmicrosoft.com** サフィックスで終わる名前) を使用します。 ただし、その結果、Microsoft Entra Domain Services の DNS ドメイン名と Microsoft Entra テナントの DNS 名が異なることを覚えておいてください。 つまり、Microsoft Entra Domain Services ドメインにサインインするときと Microsoft Entra テナントにサインインするときに、Adatum ユーザーは異なる名前を使用する必要があります。

#### タスク 3: グローバル 管理者ロールを持つ Microsoft Entra ID ユーザーを作成する

このタスクでは、新しい Microsoft Entra ID ユーザーを追加し、グローバル管理者ロールに割り当てます。 

1. **AdatumSync** Microsoft Entra テナント ブレードの **[管理]** セクションで、**[ユーザー]** をクリックします。

2. **[ユーザー | すべてのユーザー]** ブレードで、 **[+ 新しいユーザー]** 、 **[新しいユーザーの作成]** を順にクリックします。

3. **[新しいユーザー]** ブレードで、**[ユーザーの作成]** オプションが選択されていることを確認し、[基本] タブで以下の設定を指定し (その他の設定はすべて既定値のままにします)、**[次へ: プロパティ >]** をクリックします。

   |設定|値|
   |---|---|
   |ユーザー名|**syncadmin**|
   |名前|**syncadmin**|
   |パスワード|**[パスワードの自動生成]** オプションが選択されていることを確認し、 **[パスワードの表示]** をクリックします|

    >**注**:完全なユーザー名を記録します。 ドメイン名が表示されているドロップダウン リストの右側にある **[クリップボードにコピー]** ボタンをクリックしそれをメモ帳ドキュメントに貼り付けることで、値をコピーできます。 これは、このラボの後半で必要になります。

    >**注**:[パスワード] テキスト ボックスの右側にある **[クリップボードにコピー]** ボタンをクリックし、それをメモ帳のドキュメントに貼り付けてユーザーのパスワードをメモします。 これは、このラボの後半で必要になります。

4. **[プロパティ]** タブで一番下までスクロールし、[利用場所] を指定します。**[米国]** を指定して (その他の設定はすべて既定値のままにします)、**[次へ: 割り当て >]** を選択します。

5. **[割り当て]** タブで、**[+ ロールの追加]** をクリックし、**[全体管理者]** を検索して選択した後、**[選択]** をクリックします。 **[Review + create]\(レビュー + 作成\)** をクリックし、 **[作成]** をクリックします。
   
    >**注**:Azure AD Connect を導入するには、グローバル管理者の役割を持つ Azure AD ユーザーが必要です。

6. InPrivate ブラウザー ウィンドウを開きます。

7. **`https://portal.azure.com/`** にある Azure portal に移動し、**syncadmin** ユーザー アカウントを使用してサインインします。 プロンプトが表示されたら、このタスクで前に記録したパスワードを、複雑さの要件を満たす独自のパスワードに変更し、将来参照できるようにそれを記録します。 このパスワードは、後のタスクで入力を求められます。

    >**注**: サインインするには、このタスクの前半で記録した Microsoft Entra テナントの DNS ドメイン名を含む、**syncadmin** ユーザー アカウントの完全修飾名を指定する必要があります。 このユーザー名の形式は、syncadmin@`<your_tenant_name>`.onmicrosoft.com です。`<your_tenant_name>` は、一意の Microsoft Entra テナント名を表すプレースホルダーです。 

8. **syncadmin** としてサインアウトし、InPrivate ブラウザーの画面を閉じます。

> **結果**: この演習では、Microsoft Entra テナントを作成し、新しい Microsoft Entra テナントにカスタム DNS 名を追加する方法を確認し、グローバル管理者ロールを持つ Azure AD ユーザーを作成しました。


### 演習 3: Microsoft Entra ID フォレストを Microsoft Entra テナントと同期する

### 推定時間:20 分

この演習では、次のタスクを実行します。

- タスク 1: ディレクトリの同期用に Microsoft Entra Domain Services を準備する
- タスク 2: Microsoft Entra Connect をインストールする
- タスク 3:ディレクトリ同期を確認する

#### タスク 1: ディレクトリの同期用に Microsoft Entra Domain Services を準備する

このタスクでは、Microsoft Entra Domain Services ドメイン コントローラーを実行している Azure VM に接続し、ディレクトリ同期アカウントを作成します。 

   > このタスクを開始する前に、このラボの最初の演習で開始した Template deployment が正常に完了したことを確認します。

1. Azure portal では、このラボの最初の演習で Azure VM をデプロイした Azure サブスクリプションに関連付けられている Microsoft Entra テナントに **ディレクトリ + サブスクリプション** フィルターを設定します。

2. Azure portal の **[リソース、サービス、ドキュメントの検索]** テキスト ボックスで、Azure portal ページの上部に「**Virtual Machines**」と入力し、**Enter** キーを押します。

3. **[Virtual Machines]** ブレードで **adVM** エントリをクリックします。 

4. **[adVM]** ブレードで **[接続]** をクリックし、ドロップ ダウン メニューの **[RDP]** をクリックします。 

5. **[IP アドレス]** ドロップダウンで、**[ロード バランサーのパブリック IP アドレス]** を選択した後、**[RDP ファイルのダウンロード]** をクリックして、それを使用してリモート デスクトップ経由で **adVM** Azure VM に接続します。 認証を求められたら、次の資格情報を入力します。

   |設定|値|
   |---|---|
   |ユーザー名|**Student**|
   |パスワード|**ラボ 04 > 演習 1 > タスク 1 > 手順 9 で作成した個人用パスワードを使用してください。**|

    >**注**:リモート デスクトップ セッションと **サーバー マネージャー** が読み込まれるまで待ちます。  

    >**注**:**adVM** Azure VM へのリモート デスクトップ セッションでは、次の手順を実行します。

    >**注**:**[ロード バランサーのパブリック IP アドレス]** が [RDP] ブレードの **[IP アドレス]** ドロップダウンで利用できない場合は、Azure portal で **[パブリック IP アドレス]** を検索し、**[adPublicIP]** を選んでその IP アドレスをメモします。 [スタート] ボタンをクリックし、「**MSTSC**」と入力し、**Enter** キーを押して、リモート デスクトップ クライアントを起動します。 **[コンピューター:]** テキスト ボックスにロード バランサーのパブリック IP アドレスを入力し、**[接続]** をクリックします。

6. **サーバー マネージャー**で **[ツール]** をクリックし、ドロップダウン メニューで **[Microsoft Entra ID 管理センター]** を選択します。

7. **Microsoft Entra ID 管理センター**で、 **[adatum (ローカル)]** をクリックし、**[タスク]** ペインで、ドメイン名 **[adatum (ローカル)]** の下にある **[新規作成]** をクリックして、カスケード メニューで **[組織単位]** をクリックします。

8. **[組織単位の作成]** ウィンドウの **[名前]** テキスト ボックスに「**ToSync**」と入力し、**[OK]** をクリックします。

9. 新しく作成した **ToSync** 組織単位をダブルクリックすると、その内容が Microsoft Entra ID 管理センター コンソールの詳細ウィンドウに表示されます。 

10. **[タスク]** ペインの **[ToSync]** セクションで、**[新規作成]** をクリックし、カスケード メニューの **[ユーザー]** をクリックします。

11. **[ユーザーの作成]** ウィンドウで、次の設定で新しいユーザー アカウントを作成し (他の設定は既存の値のままにします)、**[OK]** をクリックします。
    
    |設定|値|
    |---|---|
    |[名前]|**aduser1**|
    |[ユーザー UPN ログオン]|**aduser1**|
    |[ユーザー SAM アカウント名ログオン]|**aduser1**|
    |[パスワード] と [パスワードの確認入力]|**ラボ 04 > 演習 1 > タスク 1 > 手順 9 で作成した個人用パスワードを使用してください。**|
    |その他のパスワード オプション|**パスワードを無期限にする**|


#### タスク 2: Microsoft Entra Connect をインストールする

このタスクでは、仮想マシンに Microsoft Entra Connect をインストールします。 

1. **adVM** へのリモート デスクトップ セッション内で、Microsoft Edge を使って Azure portal ( **https://portal.azure.com** ) に移動し、前の演習で作成した **syncadmin** ユーザー アカウントを使ってサインインします。 プロンプトが表示されたら、前の演習で記録した完全なユーザー プリンシパル名とパスワードを指定します。

2. Azure portal で、Azure portal ページの上部にある **[リソース、サービス、ドキュメントの検索]** テキスト ボックスに「**Microsoft Entra ID**」と入力し、**Enter** キーを押します。

3. Azure portal の **[AdatumSync \| 概要]** ブレードで、左側のナビゲーション パネルの **[管理]** の下にある **[Microsoft Entra Connect]** をクリックします。

4. **[Microsoft Entra Connect \| はじめに]** ブレードで、左側のナビゲーション パネルの **[Connect 同期]** をクリックして、**[Microsoft Entra Connect のダウンロード]** リンクをクリックします。 **[Microsoft Entra Connect]** ダウンロード ページにリダイレクトされます。

5. **[Microsoft Entra Connect]** ダウンロード ページで、**[ダウンロード]** をクリックします。

6. メッセージが表示されたら、[**実行**] をクリックして、**Microsoft Entra Connect** ウィザードを開始します。

7. **Microsoft Entra Connect** ウィザードの **[Microsoft Entra Connect へようこそ]** ページで、**[ライセンス条項とプライバシーに関する通知に同意する]** チェック ボックスをオンにし、**[続行]** をクリックします。

8. **Microsoft Entra Connect** ウィザードの **[簡単設定]** ページで、**[カスタマイズ]** オプションをクリックします。

9. **[必須コンポーネントのインストール]** ページで、オプションの構成オプションをすべて解除したままにして、**[インストール]** をクリックします。

10. **[ユーザー サインイン]** ページで、**[パスワード ハッシュ同期]** のみが有効になっていることを確認し、**[次へ]** をクリックします。

11. **[Microsoft Entra ID に接続]** ページで、前の演習で作成した **syncadmin** ユーザー アカウントの資格情報を使用して認証し、**[次へ]** をクリックします。 

12. **[ディレクトリの接続]** ページで、**adatum.com** フォレスト エントリの右側にある **[ディレクトリの追加]** ボタンをクリックします。

13. **[AD フォレスト アカウント]** ウィンドウで、**[新しい Microsoft Entra ID アカウントを作成]** オプションが選択されていることを確認し、次の資格情報を指定して、**[OK]** をクリックします。

    |設定|値|
    |---|---|
    |[ユーザー名]|**ADATUM\\Student**|
    |パスワード|**ラボ 06 > 演習 1 > タスク 2 で作成した個人用パスワードを使用してください**|

14. **[ディレクトリの接続]** ページに戻り、**adatum.com** エントリが構成されたディレクトリとして表示されていることを確認し、**[次へ]** をクリックします。

15. **[Microsoft Entra ID サインイン情報の構成]** ページで、**UPN サフィックスが検証済みのドメイン名と一致しない場合、ユーザーがオンプレミスの資格情報を使用して Microsoft Entra ID にサインインできないことを示す**警告を確認し、**[一部の UPN サフィックスが確認済みドメインと一致していなくても続行する]** のチェックボックスをオンにし、**[次へ]** をクリックします。

    >**注**:前述したように、カスタムの Azure AD DNS ドメイン **adatum.com** を確認できなかったため、これが予想されます。

16. **[ドメインと OU のフィルタリング]** ページで、**[選択したドメインと OU の同期]** オプションをクリックし、ドメイン名 **adatum.com** の横にあるチェックボックスをクリアします。 クリックして **adatum.com** を展開し、**ToSync** OU の横にあるチェックボックスのみを選択してから、**[次へ]** をクリックします。

17. **[ユーザーを一意に識別]** ページで、既定の設定を受け入れ、**[次へ]** をクリックします。

18. **[ユーザーおよびデバイスのフィルタリング]** ページで、既定の設定を受け入れて、**[次へ]** をクリックします。

19. **[オプション機能]** ページで、既定の設定を受け入れ、**[次へ]** をクリックします。

20. **[構成の準備完了]** ページで、**[構成が完了したら、同期プロセスを開始する]** チェック ボックスがオンになっていることを確認し、**[インストール]** をクリックします。

    >**注**:インストールにはおよそ 2 分かかります。

21. **[構成完了]** ページの情報を確認し、**[終了]** をクリックして **[Microsoft Entra Connect]** ウィンドウを閉じます。


#### タスク 3:ディレクトリ同期を確認する

このタスクでは、ディレクトリ同期が機能していることを確認します。 

1. **adVM** へのリモート デスクトップ セッション内の、Azure portal を表示する Microsoft Edge ウィンドウで、Adatum Lab Azure AD テナントの **[ユーザー - すべてのユーザー (プレビュー)]** ブレードに移動します。

2. **[ユーザー \| すべてのユーザー (プレビュー)]** ブレードで、ユーザー オブジェクトのリストに **aduser1** アカウントが含まれていることを確認してください。 

   >**注**: **aduser1** ユーザー アカウントが表示されるまで、数分待ってから **[更新]** を選択する必要がある場合があります。

3. **aduser1** アカウントをクリックし、**[プロパティ]** タブを選びます。**[オンプレミス]** セクションまで下にスクロールします。**[オンプレミスの同期が有効]** 属性が **[はい]** に設定されていることに注意してください。

4. **[aduser1]** ブレードの **[ジョブ情報]** セクションで、**[部署]** 属性が設定されていないことを確認します。

5. **adVM** へのリモート デスクトップ セッション内で、**[Microsoft Entra ID 管理センター]** に切り替え、**ToSync** OU のオブジェクトの一覧内の **[aduser1]** エントリを選択し、**[タスク]** ウインドウの **[aduser1]** セクションで、**[プロパティ]** を選択します。

6. **[aduser1]** ウィンドウの **[組織]** セクションの **[部署]** テキスト ボックスに「**売上**」と入力し、**[OK]** をクリックします。

7. **adVM ** へのリモート デスクトップ セッション内で、**Windows PowerShell** を起動します。

8. **[管理者: Windows PowerShell]** コンソールから、次を実行して、Microsoft Entra Connect の差分同期を開始します。

    ```powershell
    Import-Module -Name 'C:\Program Files\Microsoft Azure AD Sync\Bin\ADSync\ADSync.psd1'

    Start-ADSyncSyncCycle -PolicyType Delta
    ```

9. **[aduser1]** ブレードが表示されている Microsoft Edge ウィンドウに切り替え、ページを更新して、[部署] プロパティが [売上] に設定されていることを確認します。

    >**注**:**[部署]** 属性が設定されていないままの場合は、最大 3 分待ってからページを再度更新する必要がある場合があります。

> **結果**: この演習を完了すると、Microsoft Entra Domain Services をディレクトリ同期用に準備し、Microsoft Entra Connect をインストールして、ディレクトリ同期を確認したことになります。


**リソースのクリーンアップ**

>**注**: Microsoft Entra ID 同期を無効にすることから始めます

1. **adVM** へのリモート デスクトップ セッション内で、管理者として Windows PowerShell を起動します。

2. Windows PowerShell コンソールから、次のコマンドを実行して MsOnline PowerShell モジュールをインストールします (メッセージが表示されたら、[続行するには NuGet プロバイダーが必要です] ダイアログ ボックスで、「**はい**」と入力して Enter キーを押します)。

    ```powershell
    [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
    Install-PackageProvider -Name NuGet -MinimumVersion 2.8.5.201 -Force
    Install-Module MsOnline -Force
    ```

3. Windows PowerShell コンソールから、次のコマンドを実行して AdatumSync Microsoft Entra テナントに接続します (メッセージが表示されたら、**syncadmin** の資格情報でサインインします)。

    ```powershell
    Connect-MsolService
    ```

4. Windows PowerShell コンソールから、次のコマンドを実行して Microsoft Entra Connect の同期を無効にします。

    ```powershell
    Set-MsolDirSyncEnabled -EnableDirSync $false -Force
    ```

5. Windows PowerShell コンソールで、次の操作を実行して操作が正常に完了したことを確認します。

    ```powershell
    (Get-MSOLCompanyInformation).DirectorySynchronizationEnabled
    ```
    >**注**:結果は `False` となるはずです。 そうでない場合は、少し待ってからコマンドを再実行してください。

    >**注**:次に、Azure リソースを削除します
6. リモート デスクトップ セッションを終了します。

7. Azure portal で、**adVM** Azure VM をデプロイした Azure サブスクリプションに関連付けられている Microsoft Entra テナントに対し、**ディレクトリ + サブスクリプション** フィルターを設定します。

8. Azure portal から、Azure portal の右上にあるアイコンをクリックして、Cloud Shell を開きます。 

9. Cloud Shell ペインの左上隅にあるドロップダウン メニューで **[PowerShell]** を選択し、メッセージが表示されたら **[確認]** をクリックします。 

10. Cloud Shell ペイン内の PowerShell セッションで、次の手順を実行して、このラボで作成したリソース グループを削除します。
  
    ```powershell
    Remove-AzResourceGroup -Name "AZ500LAB06" -Force -AsJob
    ```
11. **[Cloud Shell]** ペインを閉じます。

    >**注**: 最後に、Microsoft Entra テナントを削除します
    
    >**注 2**:テナントの削除は非常に難しいプロセスであるため、誤ってまたは悪意を持って削除されることはありません。  つまり、このラボの一部としてテナントを削除しても、うまくいかないことがよくあります。  ここにはテナントを削除する手順がありますが、このラボを完了したと考える必要はありません。 現実の世界でテナントを削除する必要がある場合は、DOCS.Microsoft.com に役立つ記事があります。

12. Azure portal に戻り、**ディレクトリ + サブスクリプション** フィルターを使用して **AdatumSync** Microsoft Entra テナントに切り替えます。

13. Azure portal で、 **[ユーザー - すべてのユーザー]** ブレードに移動し、**syncadmin** ユーザー アカウントを表すエントリをクリックし、 **[syncadmin - プロファイル]** ブレードで **[削除]** をクリックして、確認を求められたら、 **[はい]** をクリックします。

14. 同じ一連の手順を繰り返して、**aduser1** ユーザー アカウントと**オンプレミスのディレクトリ同期サービス アカウント**を削除します。

15. Microsoft Entra テナントの **[AdatumSync - 概要]** ブレードに移動し、**[テナントの管理]** をクリックして **AdatumSync** ディレクトリのチェック ボックスをオンにし、**[削除]** をクリックします。**[テナント 'AdatumSync' の削除]** ブレードで **[Azure リソースを削除する権限を取得]** のリンクをクリックし、Microsoft Entra の **[プロパティ]** ブレードで **[Azure リソースのアクセス管理]** を **[はい]** に設定して **[保存]** をクリックします。

    >**注**:削除中に **[すべてのユーザーを削除する]** のような警告記号が表示された場合は、作成したユーザーの削除に進みます。または、警告記号に **[Delete LinkedIn applications](LinkedIn アプリケーションの削除)** と表示された場合は、警告メッセージをクリックして LinkedIn アプリケーションの削除を確認します。テナントの削除を完了するには、すべての警告に対処する必要があります。

16. Azure portal からサインアウトし、サインインし直します。 

17. **[テナント 'AdatumSync' の削除]** ブレードに戻り、 **[削除]** をクリックします。

> このタスクに関する追加情報については、[https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/directory-delete-howto](https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/directory-delete-howto) を参照してください
